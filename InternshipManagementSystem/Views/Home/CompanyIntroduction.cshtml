@model InternshipManagementSystem.Models.CompanyIntroductionViewModel

@{
    ViewBag.Title = "公司一览";
}
<br />
<br />
<h2>公司一览</h2>
<hr />
<div class="row companiesInfoRow">
    @if (Model.companies.FirstOrDefault() != null)
    {
        <nav class="col-sm-3 col-xs-12 companiesList">
            <div class="list-group nav nav-stacked">
                @{
                    var orderedCompanies = Model.companies.OrderBy(c => c.CompanyOrder);
                    var counter1 = 1;
                    foreach (var c in orderedCompanies)
                    {
                        if (c.CompanyIntroduction != null && c.InternIntroduction != null)
                        {
                            var mobileAnchorId = c.CompanyName.Replace(' ', '-') + "MobileAnchor";
                            var anchorId = c.CompanyName.Replace(' ', '-') + "Anchor";
                            var tabContentId = c.CompanyName.Replace(' ', '-') + "Tab";
                            var submitInputId = c.CompanyName.Replace(' ', '-');
                            var submitInputIdMobile = c.CompanyName.Replace(' ', '-') + "Mobile";
                            using (Ajax.BeginForm("DisplayUserSelectedCompanyDetail", "Home", null, new AjaxOptions { UpdateTargetId = "CompanyDetail", OnComplete = "calculation" }, new { @class = "form-horizontal", role = "form" }))
                            {
                                if (counter1 == 1)
                                {
                                    <a id="@anchorId" href="#" onclick="selectCompany('@c.CompanyName.Replace(' ', '-')')" class="hidden-xs list-group-item active">@c.CompanyName</a>
                                }
                                else
                                {
                                    <a id="@anchorId" href="#" onclick="selectCompany('@c.CompanyName.Replace(' ', '-')')" class="hidden-xs list-group-item">@c.CompanyName</a>
                                }
                                <input hidden type="text" name="company" value="@c.CompanyName.Replace(' ', '-')" />
                                <input hidden type="submit" id="@submitInputId" />
                            }
                            counter1++;
                            using (Ajax.BeginForm("DisplayUserSelectedCompanyDetailForMobile", "Home", null, new AjaxOptions { UpdateTargetId = tabContentId, OnComplete = "calculation" }, new { @class = "form-horizontal", role = "form" }))
                            {
                                    <a data-toggle="collapse" href="#@tabContentId" id="@mobileAnchorId" onclick="selectCompany('@c.CompanyName.Replace(' ', '-')')" class="hidden-lg hidden-md hidden-sm list-group-item">@c.CompanyName</a>
                                <div id="@tabContentId" class="collapse col-xs-12 hidden-lg hidden-md hidden-sm">
                                </div>
                                <input hidden type="text" name="company" value="@c.CompanyName.Replace(' ', '-')" />
                                <input hidden type="submit" id="@submitInputIdMobile" />
                            }
                        }

                    }
                }
            </div>
        </nav>

        <div class="col-sm-9 hidden-xs" id="CompanyDetail">
            <div class="modalOverlay"></div>
            @{
                var thisCompany = orderedCompanies.Where(c => c.CompanyIntroduction != null).FirstOrDefault();
                if (thisCompany != null)
                {
                    <h3>@thisCompany.CompanyName</h3>
                    <hr />
                    <h3>
                        公司介绍
                    </h3>
                    <pre>@thisCompany.CompanyIntroduction</pre>
                    <h3>实习内容</h3>
                    <pre>@thisCompany.InternIntroduction</pre>
                    <h3>实习地址</h3>
                    <p>@thisCompany.CompanyLocation</p>
                    <h3>负责人</h3>
                    <p>@thisCompany.PersonInCharge</p>
                }
                else
                {
                    <div class="alert alert-info">
                        <strong>暂时没有公司信息和实习介绍</strong>
                    </div>
                }

            }
        </div>
                }
                else
                {
                    <div class="alert alert-info">
                        <strong>暂时没有公司信息和实习介绍</strong>
                    </div>
                }
</div>
<script>
    $(document).ready(function () {
        if ($(window).width() >= 768) {
            $(".companiesList").css("position", "fixed");
            calculation();
        }
        else {
            $(".companiesList").css("position", "static");
        }
        $(window).resize(function () {
            if ($(window).width() >= 768) {
                $(".companiesList").css("position", "fixed");
                calculation();
            }
            else {
                $(".companiesList").css("position", "static");
            }
        });
    })

    function calculation() {
        $("#CompanyDetail").css('margin-left', $(".companiesList").outerWidth());
    }

    var selectCompanyCounter;
    var selectCompanyLatestClickedAnchor;

    function selectCompany(companyName) {
        if ($(window).width() <= 768){
            if (selectCompanyLatestClickedAnchor != companyName)
                selectCompanyCounter = 0;
            selectCompanyCounter += 1;
            $("#" + $('.list-group-item.active').attr("id").slice(0, -6) + "Tab").collapse('hide');
            $("#" + $('.list-group-item.active').attr("id").slice(0, -6) + "Tab").empty();
            if(selectCompanyCounter % 2 == 1)
                $('#' + companyName + "Mobile").click();
            selectCompanyLatestClickedAnchor = companyName;
            $('#' + companyName + 'Tab').empty();
        }
        else{
            $(".modalOverlay").show();
            $('#' + companyName).click();
        }
        $('.list-group-item.active').removeClass('active');
        $('#' + companyName + 'Anchor').addClass("active");
        $('#' + companyName + 'MobileAnchor').addClass("active");
    }
</script>
@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}
